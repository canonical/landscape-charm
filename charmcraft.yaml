# Learn more about charmcraft.yaml configuration at:
# https://juju.is/docs/sdk/charmcraft-config
type: "charm"

platforms:
  ubuntu@22.04:amd64:
  ubuntu@22.04:arm64:
  ubuntu@24.04:amd64:
  ubuntu@24.04:arm64:

charm-libs:
  - lib: data_platform_libs.data_interfaces
    version: "0"
  - lib: traefik_k8s.ingress
    version: "2"

parts:
  charm:
    plugin: charm
    source: .
    # Based on: https://github.com/canonical/mysql-operator/blob/bd8b3ddabe24d6bcb1b181c4ecedf8515cd98ce0/charmcraft.yaml#L56-L80
    build-packages:
      - libffi-dev # Needed to build Python dependencies with Rust from source
      - libssl-dev # Needed to build Python dependencies with Rust from source
      - pkg-config # Needed to build Python dependencies with Rust from source
    after:
      - poetry-deps
    poetry-export-extra-args: ["--only", "main"]
