description: Landscape scalable integration testing
applications:
  postgresql:
    channel: 16/stable
    charm: ch:postgresql
    base: ubuntu@24.04
    num_units: 1
    options:
      plugin_plpython3u_enable: true
      plugin_ltree_enable: true
      plugin_intarray_enable: true
      plugin_debversion_enable: true
      plugin_pg_trgm_enable: true
      experimental_max_connections: 500
  rabbitmq-server:
    channel: latest/edge
    charm: ch:rabbitmq-server
    num_units: 1
    options:
      consumer-timeout: 259200000
  landscape-server:
    charm: ../../landscape-server_ubuntu@24.04-amd64.charm
    num_units: 2
    base: ubuntu@24.04
    options:
      landscape_ppa: ppa:landscape/self-hosted-beta
      min_install: True
      enable_hostagent_messenger: true
      enable_ubuntu_installer_attach: true
      root_url: https://landscape.local/
      redirect_https: none
  hostagent-messenger-ingress:
    charm: ingress-configurator
    channel: latest/edge
    options:
      external-grpc-port: 6554
      hostname: landscape.local
      backend-protocol: https
  http-ingress:
    charm: ingress-configurator
    channel: latest/edge
    options:
      paths: /
      hostname: landscape.local
      header-rewrite-expressions: "X-Forwarded-Proto:https"
      allow-http: true
  ubuntu-installer-attach-ingress:
    charm: ingress-configurator
    channel: latest/edge
    options:
      external-grpc-port: 50051
      hostname: landscape.local
      backend-protocol: https
  lb-certs:
    charm: self-signed-certificates
    channel: stable
relations:
  - [landscape-server:inbound-amqp, rabbitmq-server]
  - [landscape-server:outbound-amqp, rabbitmq-server]
  - [landscape-server:database, postgresql:database]
  - [landscape-server:load-balancer-certificates, lb-certs:certificates]
  - [landscape-server:hostagent-messenger-ingress, hostagent-messenger-ingress:ingress]
  - [landscape-server:ubuntu-installer-attach-ingress, ubuntu-installer-attach-ingress:ingress]
  - [landscape-server:http-ingress, http-ingress:ingress]
