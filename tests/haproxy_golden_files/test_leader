- backends:
  - backend_name: landscape-ping
    servers:
    - - landscape-pingserver-landscape-server-0-0
      - 192.168.0.1
      - 8070
      - &id001
        - check
        - inter 5000
        - rise 2
        - fall 5
        - maxconn 50
  error_files: &id003
  - content: !!binary |
      VkVoSlV5QkpVeUJGVWxKUFVpQkdTVXhGSUVaUFVpQTBNRE1L
    http_status: '403'
  - content: !!binary |
      VkVoSlV5QkpVeUJGVWxKUFVpQkdTVXhGSUVaUFVpQTFNREFL
    http_status: '500'
  - content: !!binary |
      VkVoSlV5QkpVeUJGVWxKUFVpQkdTVXhGSUVaUFVpQTFNRE1L
    http_status: '502'
  - content: !!binary |
      VkVoSlV5QkpVeUJGVWxKUFVpQkdTVXhGSUVaUFVpQTFNRE1L
    http_status: '503'
  - content: !!binary |
      VkVoSlV5QkpVeUJGVWxKUFVpQkdTVXhGSUVaUFVpQTFNRFFL
    http_status: '504'
  servers: &id002
  - - landscape-appserver-landscape-server-0-0
    - 192.168.0.1
    - 8080
    - *id001
  service_host: 0.0.0.0
  service_name: landscape-http
  service_options:
  - mode http
  - timeout client 300000
  - timeout server 300000
  - balance leastconn
  - option httpchk HEAD / HTTP/1.0
  - acl ping path_beg -i /ping
  - acl repository path_beg -i /repository
  - redirect scheme https unless ping OR repository
  - use_backend landscape-ping if ping
  - acl metrics path_end /metrics
  - http-request deny if metrics
  service_port: 80
- backends:
  - backend_name: landscape-message
    servers:
    - - landscape-message-server-landscape-server-0-0
      - 192.168.0.1
      - 8090
      - *id001
  - backend_name: landscape-api
    servers:
    - - landscape-api-landscape-server-0-0
      - 192.168.0.1
      - 9080
      - *id001
  - backend_name: landscape-package-upload
    servers:
    - - landscape-package-upload-landscape-server-0-0
      - 192.168.0.1
      - 9100
      - *id001
  - backend_name: landscape-hashid-databases
    servers: *id002
  crts:
  - DEFAULT
  error_files: *id003
  servers: *id002
  service_host: 0.0.0.0
  service_name: landscape-https
  service_options:
  - mode http
  - timeout client 300000
  - timeout server 300000
  - balance leastconn
  - option httpchk HEAD / HTTP/1.0
  - http-request set-header X-Forwarded-Proto https
  - acl message path_beg -i /message-system
  - acl attachment path_beg -i /attachment
  - acl api path_beg -i /api
  - acl ping path_beg -i /ping
  - use_backend landscape-message if message
  - use_backend landscape-message if attachment
  - use_backend landscape-api if api
  - use_backend landscape-ping if ping
  - acl hashids path_beg -i /hash-id-databases
  - use_backend landscape-hashid-databases if hashids
  - acl package-upload path_beg -i /upload
  - use_backend landscape-package-upload if package-upload
  - http-request replace-path ^([^\ ]*)\ /upload/(.*) /\1
  - acl metrics path_end /metrics
  - http-request deny if metrics
  - acl prometheus_metrics path_beg -i /metrics
  - http-request deny if prometheus_metrics
  service_port: 443
- crts:
  - DEFAULT
  error_files: *id003
  server_options:
  - proto h2
  servers:
  - - landscape-hostagent-messenger-landscape-server-0-0
    - 192.168.0.1
    - 50052
    - - check
      - inter 5000
      - rise 2
      - fall 5
      - maxconn 50
      - proto h2
  service_host: 0.0.0.0
  service_name: landscape-grpc
  service_port: 6554
